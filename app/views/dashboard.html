<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - LMS</title>
    <script src="{{ @BASE }}/public/js/library/TailWind-3.4.17"></script>
    <link href="{{ @BASE }}/public/css/fonts/css2.css" rel="stylesheet">
    <link rel="stylesheet" href="{{ @BASE }}/public/css/library/all.min.css">
    <script src="{{ @BASE }}/public/js/npm/chart.js"></script>
    <script src="{{ @BASE }}/public/js/npm/sweetalert2@11.js"></script>
    <script src='{{ @BASE }}/public/js/npm/fullcalendar@6.1.8/index.global.min.js'></script>
    <link rel="stylesheet" href="{{ @BASE }}/public/css/style.css">
    <link rel="stylesheet" href="{{ @BASE }}/public/css/custom.css">
</head>
<body class="flex h-screen overflow-hidden bg-zinc-950 text-zinc-100 antialiased selection:bg-white selection:text-zinc-950 text-sm">

    <!-- Mobile Overlay Backdrop -->
    <div id="mobileOverlay" class="fixed inset-0 bg-black/80 z-20 hidden md:hidden" onclick="toggleSidebar()"></div>

    <!-- Sidebar -->
    <aside id="sidebar" class="fixed inset-y-0 left-0 w-72 bg-zinc-950 border-r border-zinc-800 flex flex-col justify-between z-30 transform -translate-x-full transition-transform duration-300 md:relative md:translate-x-0 shrink-0">
        <div>
            <!-- Header Logo -->
            <div class="h-20 flex items-center px-8 border-b border-zinc-900 justify-between">
                <div class="flex items-center gap-3">
                    <div class="w-8 h-8 rounded-lg bg-white text-zinc-950 flex items-center justify-center font-bold text-lg">L</div>
                    <span class="text-lg font-semibold text-white tracking-tight">LeaveSys</span>
                </div>
                <button class="md:hidden text-zinc-500 hover:text-white" onclick="toggleSidebar()">
                    <i class="fa-solid fa-xmark text-xl"></i>
                </button>
            </div>

            <nav class="mt-8 space-y-1">
                <p class="px-8 text-xs font-medium text-zinc-500 uppercase tracking-wider mb-3">Menu</p>
                
                <div onclick="switchView('overview')" class="sidebar-link active flex items-center gap-3 px-8 py-3.5 text-sm font-medium" id="nav-overview">
                    <i class="fa-solid fa-chart-pie w-5 text-center opacity-70"></i>
                    <span>Overview</span>
                </div>
                
                <div onclick="switchView('calendar')" class="sidebar-link flex items-center gap-3 px-8 py-3.5 text-sm font-medium" id="nav-calendar">
                    <i class="fa-regular fa-calendar w-5 text-center opacity-70"></i>
                    <span>Calendar</span>
                </div>

                <check if="{{ @SESSION.role=='employee' }}">
                    <div onclick="switchView('new-request')" class="sidebar-link flex items-center gap-3 px-8 py-3.5 text-sm font-medium" id="nav-new-request">
                        <i class="fa-solid fa-plus w-5 text-center opacity-70"></i>
                        <span>New Request</span>
                    </div>
                </check>
                
                <check if="{{ @SESSION.role!='employee' }}">
                    <p class="px-8 text-xs font-medium text-zinc-500 uppercase tracking-wider mt-8 mb-3">Admin</p>
                    
                    <div onclick="switchView('approvals')" class="sidebar-link flex items-center gap-3 px-8 py-3.5 text-sm font-medium" id="nav-approvals">
                        <i class="fa-solid fa-inbox w-5 text-center opacity-70"></i>
                        <span>Approvals</span>
                        <check if="{{ @pendingReq > 0 }}">
                            <span class="ml-auto bg-zinc-800 text-white text-[10px] font-bold px-2 py-0.5 rounded-full border border-zinc-700">{{ @pendingReq }}</span>
                        </check>
                    </div>

                    <a href="{{ @BASE }}/report" target="_blank" class="sidebar-link flex items-center gap-3 px-8 py-3.5 text-sm font-medium">
                        <i class="fa-solid fa-file-arrow-down w-5 text-center opacity-70"></i>
                        <span>Reports</span>
                    </a>
                </check>

                <check if="{{ @SESSION.role=='admin' }}">
                    <div onclick="switchView('users')" class="sidebar-link flex items-center gap-3 px-8 py-3.5 text-sm font-medium" id="nav-users">
                        <i class="fa-solid fa-user-gear w-5 text-center opacity-70"></i>
                        <span>Users</span>
                    </div>
                </check>
            </nav>
        </div>

        <!-- User Profile Minimal -->
        <div class="p-6 border-t border-zinc-900">
            <div class="flex items-center justify-between group">
                <div onclick="openProfileModal()" class="flex items-center gap-3 cursor-pointer">
                    <div class="w-9 h-9 rounded-full bg-zinc-800 border border-zinc-700 flex items-center justify-center text-xs text-white font-medium transition-colors group-hover:bg-zinc-700 group-hover:border-zinc-600">
                        {{ substr(@SESSION.full_name, 0, 2) }}
                    </div>
                    <div class="overflow-hidden">
                        <p class="text-sm font-medium text-white truncate w-28 group-hover:text-zinc-300 transition-colors">{{ @SESSION.full_name }}</p>
                        <p class="text-[11px] text-zinc-500 capitalize">{{ @SESSION.role }}</p>
                    </div>
                </div>
                <button id="logoutBtn" class="text-zinc-500 hover:text-white transition-colors p-2" title="Logout">
                    <i class="fa-solid fa-arrow-right-from-bracket"></i>
                </button>
            </div>
        </div>
    </aside>

    <!-- Content Area -->
    <div class="flex-1 flex flex-col h-screen overflow-hidden relative bg-zinc-950">
        <!-- Header -->
        <header class="h-20 bg-zinc-950/80 backdrop-blur-md border-b border-zinc-800 px-6 md:px-10 flex justify-between items-center z-10 shrink-0">
            <div class="flex items-center gap-4">
                <button id="mobileMenuBtn" onclick="toggleSidebar()" class="md:hidden text-zinc-400 hover:text-white p-2 -ml-2">
                    <i class="fa-solid fa-bars text-xl"></i>
                </button>
                <div>
                    <h1 class="text-xl font-semibold text-white tracking-tight" id="pageTitle">Dashboard</h1>
                </div>
            </div>
            <div class="flex items-center gap-4">
                <div class="hidden md:flex items-center gap-2 bg-zinc-900 border border-zinc-800 rounded-full px-4 py-1.5">
                    <span class="w-1.5 h-1.5 rounded-full bg-emerald-500"></span>
                    <span class="text-xs font-medium text-zinc-400">Live</span>
                </div>
            </div>
        </header>

        <main class="flex-1 overflow-y-auto p-6 md:p-10 scroll-smooth">
            
            <!-- VIEW 1: OVERVIEW -->
            <div id="view-overview" class="view-section active">
                
                <!-- EMPLOYEE STATS -->
                <check if="{{ @SESSION.role=='employee' }}">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
                        <div class="panel p-6 rounded-xl hover:border-zinc-600 transition-colors duration-300">
                            <div class="flex justify-between items-start mb-8">
                                <div class="p-3 bg-zinc-900 rounded-lg border border-zinc-800 text-zinc-100"><i class="fa-solid fa-umbrella-beach text-lg"></i></div>
                                <span class="text-zinc-500 text-xs uppercase tracking-wider font-medium">Vacation</span>
                            </div>
                            <div>
                                <h3 class="text-4xl font-semibold text-white mb-1">{{ @balance.vacation_balance }}</h3>
                                <p class="text-sm text-zinc-500">Days Available</p>
                            </div>
                        </div>

                        <div class="panel p-6 rounded-xl hover:border-zinc-600 transition-colors duration-300">
                            <div class="flex justify-between items-start mb-8">
                                <div class="p-3 bg-zinc-900 rounded-lg border border-zinc-800 text-zinc-100"><i class="fa-solid fa-heart-pulse text-lg"></i></div>
                                <span class="text-zinc-500 text-xs uppercase tracking-wider font-medium">Sick Leave</span>
                            </div>
                            <div>
                                <h3 class="text-4xl font-semibold text-white mb-1">{{ @balance.sick_balance }}</h3>
                                <p class="text-sm text-zinc-500">Days Available</p>
                            </div>
                        </div>
                    </div>
                </check>

                <!-- ADMIN/MANAGER STATS -->
                <check if="{{ @SESSION.role!='employee' }}">
                    <div class="grid grid-cols-1 md:grid-cols-2 {{ @SESSION.role=='admin' ? 'lg:grid-cols-4' : 'lg:grid-cols-3' }} gap-5 mb-8">
                        
                        <div class="panel p-5 rounded-xl flex flex-col justify-between min-h-[140px]">
                            <div class="flex justify-between items-start">
                                 <div><p class="text-xs font-medium text-zinc-500 uppercase tracking-wider">Total</p><h3 class="text-2xl font-semibold text-white mt-1">{{ @totalReq }}</h3></div>
                                 <div class="text-zinc-600"><i class="fa-solid fa-layer-group"></i></div>
                            </div>
                        </div>

                        <div class="panel p-5 rounded-xl flex flex-col justify-between cursor-pointer hover:bg-zinc-900 transition min-h-[140px]" onclick="switchView('approvals')">
                            <div class="flex justify-between items-start">
                                 <div><p class="text-xs font-medium text-zinc-500 uppercase tracking-wider">Pending</p><h3 class="text-2xl font-semibold text-white mt-1">{{ @pendingReq }}</h3></div>
                                 <div class="text-amber-500"><i class="fa-solid fa-clock"></i></div>
                            </div>
                            <div class="mt-2"><span class="text-[10px] text-amber-500 bg-amber-500/10 px-2 py-1 rounded border border-amber-500/20">Action Required</span></div>
                        </div>

                        <div class="panel p-5 rounded-xl flex flex-col justify-between min-h-[140px]">
                             <div class="flex justify-between items-start">
                                 <div><p class="text-xs font-medium text-zinc-500 uppercase tracking-wider">Approved</p><h3 class="text-2xl font-semibold text-white mt-1">{{ @approvedReq }}</h3></div>
                                 <div class="text-emerald-500"><i class="fa-solid fa-check"></i></div>
                            </div>
                        </div>

                        <!-- Chart for Admin -->
                        <check if="{{ @SESSION.role=='admin' }}">
                            <div class="panel rounded-xl p-5 flex flex-col justify-between h-full min-h-[140px]">
                                <h3 class="text-zinc-500 font-medium text-xs uppercase tracking-wider">Distribution</h3>
                                <div class="flex-1 flex items-center gap-4 mt-2">
                                    <div class="h-16 w-16 relative shrink-0">
                                        <canvas id="typeChart"></canvas>
                                    </div>
                                    <div id="customLegend" class="flex-1 grid grid-cols-2 gap-x-2 gap-y-1 text-[10px] text-zinc-400"></div>
                                </div>
                            </div>
                        </check>
                    </div>
                </check>

                <!-- MAIN GRID -->
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                    <!-- History / Line Chart -->
                    <div class="lg:col-span-2">
                        <div class="panel rounded-xl overflow-hidden h-full flex flex-col">
                            <div class="px-6 py-5 border-b border-zinc-800 flex justify-between items-center">
                                <h3 class="text-white font-medium text-sm tracking-wide">{{ @SESSION.role=='employee' ? 'Recent History' : 'Activity Trend' }}</h3>
                            </div>
                            <div class="p-6 flex-1">
                                <check if="{{ @SESSION.role=='employee' }}">
                                    <div class="overflow-x-auto">
                                        <table class="w-full text-left border-collapse min-w-[500px]">
                                            <thead>
                                                <tr class="text-xs font-medium text-zinc-500 uppercase border-b border-zinc-800 tracking-wider">
                                                    <th class="pb-3 pl-2 w-32">Status</th><th class="pb-3">Type</th><th class="pb-3">Days</th><th class="pb-3 text-right pr-2">Period</th>
                                                </tr>
                                            </thead>
                                            <tbody class="text-sm">
                                                <repeat group="{{ @myReqs }}" value="{{ @row }}">
                                                    <tr class="border-b border-zinc-800/50 last:border-0 group hover:bg-zinc-900/50 transition-colors">
                                                        <td class="py-4 pl-2">
                                                            <span class="inline-flex items-center gap-1.5 px-2.5 py-1 rounded-md text-[11px] font-medium border {{ @row.status=='Approved'?'bg-emerald-500/10 text-emerald-400 border-emerald-500/20':(@row.status=='Rejected'?'bg-rose-500/10 text-rose-400 border-rose-500/20':'bg-amber-500/10 text-amber-400 border-amber-500/20') }}">
                                                                <span class="w-1.5 h-1.5 rounded-full {{ @row.status=='Approved'?'bg-emerald-500':(@row.status=='Rejected'?'bg-rose-500':'bg-amber-500') }}"></span>
                                                                {{ @row.status }}
                                                            </span>
                                                        </td>
                                                        <td class="py-4 font-medium text-zinc-300">{{ @row.leave_type }}</td>
                                                        <td class="py-4 text-zinc-500">{{ @row.days_count }}</td>
                                                        <td class="py-4 text-xs text-zinc-500 font-mono text-right pr-2">{{ @row.start_date }} <span class="text-zinc-700 mx-1">â†’</span> {{ @row.end_date }}</td>
                                                    </tr>
                                                </repeat>
                                            </tbody>
                                        </table>
                                    </div>
                                </check>
                                <check if="{{ @SESSION.role!='employee' }}">
                                    <div class="h-[300px] w-full"><canvas id="lineChart"></canvas></div>
                                </check>
                            </div>
                        </div>
                    </div>

                    <!-- Side Widgets -->
                    <div class="lg:col-span-1 space-y-6">
                        
                        <!-- Manager Distribution Chart -->
                        <check if="{{ @SESSION.role=='manager' }}">
                            <div class="panel rounded-xl p-6">
                                <h3 class="text-zinc-400 font-medium text-xs uppercase tracking-wider mb-6">Leave Distribution</h3>
                                <div class="flex flex-col items-center">
                                    <div class="h-40 w-40 relative">
                                        <canvas id="typeChart"></canvas>
                                        <div class="absolute inset-0 flex flex-col items-center justify-center pointer-events-none">
                                            <span class="text-2xl font-semibold text-white" id="totalRequestsCenter">0</span>
                                        </div>
                                    </div>
                                    <div id="customLegend" class="flex gap-4 mt-6 text-xs text-zinc-400"></div>
                                </div>
                            </div>
                        </check>

                        <!-- Admin Logs -->
                        <check if="{{ @SESSION.role=='admin' }}">
                            <div class="panel rounded-xl p-6 flex flex-col h-full max-h-[400px]">
                                <h3 class="text-white font-medium text-sm mb-4 flex items-center gap-2">
                                    <span class="w-2 h-2 rounded-full bg-blue-500 animate-pulse"></span>
                                    System Activity
                                </h3>
                                <div id="activityFeed" class="space-y-4 overflow-y-auto pr-2 custom-scrollbar flex-1"></div>
                            </div>
                        </check>

                        <!-- Employee Welcome -->
                         <check if="{{ @SESSION.role=='employee' }}">
                            <div class="panel rounded-xl p-8 text-center flex flex-col justify-center h-full">
                                <div class="w-16 h-16 rounded-2xl bg-zinc-900 border border-zinc-800 flex items-center justify-center text-zinc-400 mb-4 mx-auto">
                                    <i class="fa-regular fa-id-card text-2xl"></i>
                                </div>
                                <h3 class="text-white font-semibold text-lg">Hello, {{ @SESSION.full_name }}</h3>
                                <p class="text-zinc-500 text-sm mt-2 mb-6">Need time off? Submit a request using the button below.</p>
                                <button onclick="switchView('new-request')" class="w-full py-3 bg-white hover:bg-zinc-200 text-zinc-950 rounded-lg text-sm font-medium transition shadow-sm">
                                    Create Request
                                </button>
                            </div>
                        </check>
                    </div>
                </div>
            </div>

            <!-- VIEW 2: CALENDAR -->
            <div id="view-calendar" class="view-section">
                <div class="panel rounded-xl p-6 md:p-8">
                    <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-6 gap-4">
                        <h3 class="text-white font-semibold text-lg">Schedule</h3>
                        <check if="{{ @SESSION.role!='employee' }}">
                            <button onclick="toggleModal('eventModal')" class="bg-zinc-900 hover:bg-zinc-800 border border-zinc-700 text-white text-xs font-medium px-4 py-2 rounded-lg transition-colors flex items-center gap-2">
                                <i class="fa fa-plus"></i> Add Event
                            </button>
                        </check>
                    </div>
                    <div id='calendar' class="text-sm"></div>
                </div>
            </div>

            <!-- VIEW 3: NEW REQUEST -->
            <check if="{{ @SESSION.role=='employee' }}">
                <div id="view-new-request" class="view-section">
                    <div class="max-w-2xl mx-auto">
                        <div class="panel rounded-xl p-8">
                            <div class="text-center mb-8">
                                <h2 class="text-2xl font-semibold text-white">Request Leave</h2>
                                <p class="text-zinc-500 text-sm mt-1">Fill in the details below</p>
                            </div>

                            <form id="leaveForm" class="space-y-6">
                                <div class="space-y-2">
                                    <label class="text-xs font-medium text-zinc-500 uppercase tracking-wider">Type</label>
                                    <div class="grid grid-cols-3 gap-3">
                                        <label class="cursor-pointer relative">
                                            <input type="radio" name="leave_type" value="Sick" class="peer sr-only">
                                            <div class="p-4 rounded-lg border border-zinc-800 bg-zinc-950 text-center hover:bg-zinc-900 peer-checked:border-zinc-500 peer-checked:bg-white peer-checked:text-zinc-950 text-zinc-400 transition-all">
                                                <div class="text-sm font-medium">Sick</div>
                                            </div>
                                        </label>
                                        <label class="cursor-pointer relative">
                                            <input type="radio" name="leave_type" value="Vacation" class="peer sr-only">
                                            <div class="p-4 rounded-lg border border-zinc-800 bg-zinc-950 text-center hover:bg-zinc-900 peer-checked:border-zinc-500 peer-checked:bg-white peer-checked:text-zinc-950 text-zinc-400 transition-all">
                                                <div class="text-sm font-medium">Vacation</div>
                                            </div>
                                        </label>
                                        <label class="cursor-pointer relative">
                                            <input type="radio" name="leave_type" value="Emergency" class="peer sr-only">
                                            <div class="p-4 rounded-lg border border-zinc-800 bg-zinc-950 text-center hover:bg-zinc-900 peer-checked:border-zinc-500 peer-checked:bg-white peer-checked:text-zinc-950 text-zinc-400 transition-all">
                                                <div class="text-sm font-medium">Other</div>
                                            </div>
                                        </label>
                                    </div>
                                </div>

                                <div class="grid grid-cols-2 gap-4">
                                    <div class="space-y-2">
                                        <label class="text-xs font-medium text-zinc-500 uppercase tracking-wider">Start Date</label>
                                        <input type="date" name="start_date" class="w-full bg-zinc-950 border border-zinc-800 rounded-lg px-4 py-3 text-sm text-white focus:outline-none focus:border-zinc-500 transition-colors" required>
                                    </div>
                                    <div class="space-y-2">
                                        <label class="text-xs font-medium text-zinc-500 uppercase tracking-wider">End Date</label>
                                        <input type="date" name="end_date" class="w-full bg-zinc-950 border border-zinc-800 rounded-lg px-4 py-3 text-sm text-white focus:outline-none focus:border-zinc-500 transition-colors" required>
                                    </div>
                                </div>

                                <div class="space-y-2">
                                    <label class="text-xs font-medium text-zinc-500 uppercase tracking-wider">Reason</label>
                                    <textarea name="reason" rows="3" class="w-full bg-zinc-950 border border-zinc-800 rounded-lg px-4 py-3 text-sm text-white focus:outline-none focus:border-zinc-500 transition-colors resize-none" placeholder="Optional notes..." required></textarea>
                                </div>

                                <div class="pt-4">
                                    <button class="w-full bg-white hover:bg-zinc-200 text-zinc-900 font-medium py-3 rounded-lg transition-colors shadow-lg shadow-white/5">
                                        Submit Request
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </check>

            <!-- VIEW 4: APPROVALS -->
            <check if="{{ @SESSION.role!='employee' }}">
                <div id="view-approvals" class="view-section">
                    <div class="panel rounded-xl p-6 md:p-8">
                        <div class="flex justify-between items-center mb-8">
                            <h3 class="text-white font-semibold text-lg">Requests</h3>
                            <span class="bg-zinc-900 text-zinc-400 text-xs font-medium px-3 py-1 rounded-full border border-zinc-800">{{ @pendingReq }} Pending</span>
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                            <repeat group="{{ @pendingList }}" value="{{ @r }}">
                                <!-- UPDATED: Passing only ID now, referencing global data array for safety -->
                                <div onclick="openRequestModal('{{ @r.id }}')" class="bg-zinc-950 border border-zinc-800 p-5 rounded-xl cursor-pointer hover:border-zinc-600 transition-all group relative">
                                    <div class="flex items-center gap-4 mb-4">
                                        <div class="w-10 h-10 rounded-full bg-zinc-900 border border-zinc-800 flex items-center justify-center text-xs font-bold text-white">{{ strtoupper(substr(@r.full_name,0,2)) }}</div>
                                        <div class="overflow-hidden">
                                            <h4 class="text-sm font-medium text-white truncate">{{ @r.full_name }}</h4>
                                            <p class="text-[10px] text-zinc-500 uppercase tracking-wide mt-0.5">{{ @r.leave_type }}</p>
                                        </div>
                                    </div>
                                    <div class="flex justify-between items-end border-t border-zinc-900 pt-3">
                                        <div class="text-zinc-500 text-xs font-mono">{{ @r.start_date }}</div>
                                        <div class="text-zinc-300 text-xs font-medium">{{ @r.days_count }} Days</div>
                                    </div>
                                </div>
                            </repeat>
                            <check if="{{ count(@pendingList)==0 }}">
                                <div class="col-span-full py-12 text-center">
                                    <div class="w-12 h-12 bg-zinc-900 rounded-full flex items-center justify-center mx-auto mb-4 text-zinc-600"><i class="fa-solid fa-check"></i></div>
                                    <p class="text-zinc-500 text-sm">All caught up!</p>
                                </div>
                            </check>
                        </div>
                    </div>
                </div>
            </check>

            <!-- VIEW 5: MANAGE USERS (NEW TABLE VIEW) -->
            <check if="{{ @SESSION.role=='admin' }}">
                <div id="view-users" class="view-section">
                    <div class="panel rounded-xl p-6 md:p-8 min-h-[500px] flex flex-col">
                        
                        <!-- Header & Actions -->
                        <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-6 gap-4">
                            <div>
                                <h3 class="text-white font-semibold text-lg">User Management</h3>
                                <p class="text-zinc-500 text-sm">View and manage system access</p>
                            </div>
                            <button onclick="openUserModal()" class="bg-white hover:bg-zinc-200 text-zinc-950 text-sm font-medium px-4 py-2 rounded-lg transition shadow-sm flex items-center gap-2">
                                <i class="fa-solid fa-plus"></i> Add User
                            </button>
                        </div>

                        <!-- Users Table -->
                        <div class="overflow-x-auto">
                            <table class="w-full text-left border-collapse">
                                <thead>
                                    <tr class="text-xs font-medium text-zinc-500 uppercase border-b border-zinc-800 tracking-wider">
                                        <th class="pb-3 pl-2">User</th>
                                        <th class="pb-3">Role</th>
                                        <th class="pb-3">Balance (Vac/Sick)</th>
                                        <th class="pb-3 text-right pr-2">Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="usersTableBody" class="text-sm">
                                    <!-- Populated via JS -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </check>
        </main>
    </div>

    <!-- MODALS -->
    
    <!-- PROFILE MODAL -->
    <div id="profileModal" class="fixed inset-0 z-50 hidden p-4 overflow-y-auto">
        <div class="absolute inset-0 bg-black/80 backdrop-blur-sm" onclick="toggleModal('profileModal')"></div>
        <div class="relative top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 bg-zinc-950 border border-zinc-800 w-full max-w-sm rounded-2xl p-0 shadow-2xl overflow-hidden">
            
            <!-- Modal Header / Cover -->
            <div class="h-24 bg-zinc-900 border-b border-zinc-800/50 relative">
                <button onclick="toggleModal('profileModal')" class="absolute top-4 right-4 text-zinc-400 hover:text-white bg-black/20 p-1 rounded-full backdrop-blur-sm transition-colors">
                    <i class="fa-solid fa-xmark text-lg w-6 h-6 flex items-center justify-center"></i>
                </button>
            </div>

            <!-- Avatar & Main Info -->
            <div class="px-6 pb-6 relative">
                <div class="-mt-10 mb-4 flex justify-between items-end">
                    <div class="w-20 h-20 rounded-2xl bg-zinc-950 border-4 border-zinc-950 flex items-center justify-center text-2xl text-white font-bold shadow-lg" id="profileAvatar">
                        <!-- Initials injected via JS -->
                    </div>
                    <span id="profileRoleBadge" class="mb-2 px-2.5 py-1 rounded-md text-[10px] font-bold uppercase tracking-wider border bg-zinc-900 text-zinc-400 border-zinc-700">
                        <!-- Role injected via JS -->
                    </span>
                </div>

                <h3 id="profileName" class="text-xl font-semibold text-white tracking-tight"></h3>
                <p id="profileUsername" class="text-zinc-500 text-sm font-mono mb-6">@username</p>

                <div id="profileBalances" class="grid grid-cols-2 gap-3 mb-6 hidden">
                    <div class="bg-zinc-900/50 border border-zinc-800 p-3 rounded-xl">
                        <div class="text-[10px] uppercase text-zinc-500 font-medium tracking-wider mb-1">Vacation</div>
                        <div class="text-xl font-semibold text-white" id="p_vacation">0</div>
                    </div>
                    <div class="bg-zinc-900/50 border border-zinc-800 p-3 rounded-xl">
                        <div class="text-[10px] uppercase text-zinc-500 font-medium tracking-wider mb-1">Sick Leave</div>
                        <div class="text-xl font-semibold text-white" id="p_sick">0</div>
                    </div>
                </div>

                <!-- Details List -->
                <div class="space-y-3 pt-2 border-t border-zinc-900">
                    <div class="flex justify-between items-center text-sm">
                        <span class="text-zinc-500">User ID</span>
                        <span id="profileId" class="text-zinc-300 font-mono"></span>
                    </div>
                    <div class="flex justify-between items-center text-sm">
                        <span class="text-zinc-500">Account Status</span>
                        <span class="text-emerald-400 flex items-center gap-1.5"><div class="w-1.5 h-1.5 rounded-full bg-emerald-500"></div> Active</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- REQUEST APPROVAL MODAL -->
    <div id="requestModal" class="fixed inset-0 z-50 hidden p-4 overflow-y-auto">
        <div class="absolute inset-0 bg-black/80 backdrop-blur-sm" onclick="toggleModal('requestModal')"></div>
        <div class="relative top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 bg-zinc-950 border border-zinc-800 w-full max-w-md rounded-2xl p-6 shadow-2xl">
            <div class="flex justify-between items-start mb-6">
                <div><h3 class="text-lg font-semibold text-white">Review Request</h3></div>
                <button onclick="toggleModal('requestModal')" class="text-zinc-500 hover:text-white"><i class="fa-solid fa-xmark text-lg"></i></button>
            </div>
            <div class="bg-zinc-900 rounded-xl p-5 mb-6 border border-zinc-800/50">
                <div class="flex items-center gap-3 mb-4 border-b border-zinc-800 pb-4">
                    <div class="w-10 h-10 rounded-full bg-zinc-800 flex items-center justify-center text-sm font-medium text-white"><i class="fa-solid fa-user"></i></div>
                    <div><h4 id="reqName" class="text-white font-medium text-base"></h4><span id="reqType" class="text-[10px] font-bold px-2 py-0.5 rounded bg-zinc-800 text-zinc-400 uppercase tracking-wide"></span></div>
                </div>
                <div class="grid grid-cols-2 gap-4 mb-4">
                    <div><p class="text-[10px] uppercase text-zinc-500 font-medium tracking-wider mb-1">Start</p><p id="reqStart" class="text-sm text-zinc-200 font-mono"></p></div>
                    <div><p class="text-[10px] uppercase text-zinc-500 font-medium tracking-wider mb-1">End</p><p id="reqEnd" class="text-sm text-zinc-200 font-mono"></p></div>
                </div>
                <div><p class="text-[10px] uppercase text-zinc-500 font-medium tracking-wider mb-2">Reason</p><p id="reqReason" class="text-sm text-zinc-400 bg-zinc-950 p-3 rounded-lg border border-zinc-800"></p></div>
            </div>
            <div class="flex gap-3">
                <button onclick="processRequest('Approved')" class="flex-1 bg-white hover:bg-zinc-200 text-zinc-950 font-medium py-3 rounded-lg transition text-sm">Approve</button>
                <button onclick="processRequest('Rejected')" class="flex-1 bg-zinc-900 hover:bg-zinc-800 border border-zinc-800 text-white font-medium py-3 rounded-lg transition text-sm">Reject</button>
            </div>
        </div>
    </div>

    <!-- EVENT MODAL -->
    <div id="eventModal" class="fixed inset-0 z-50 hidden p-4 overflow-y-auto">
        <div class="absolute inset-0 bg-black/80 backdrop-blur-sm" onclick="toggleModal('eventModal')"></div>
        <div class="relative top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 bg-zinc-950 border border-zinc-800 w-full max-w-md rounded-2xl p-6 shadow-2xl">
            <h3 class="text-lg font-semibold text-white mb-6">Add Event</h3>
            <form id="addEventForm" class="space-y-4">
                <div><label class="text-xs font-medium text-zinc-500 uppercase mb-1.5 block tracking-wider">Title</label><input type="text" name="title" class="w-full bg-zinc-900 border border-zinc-800 rounded-lg p-3 text-white outline-none text-sm" required></div>
                <div class="grid grid-cols-2 gap-4">
                    <div><label class="text-xs font-medium text-zinc-500 uppercase mb-1.5 block tracking-wider">Start</label><input type="date" name="start_date" class="w-full bg-zinc-900 border border-zinc-800 rounded-lg p-3 text-white outline-none text-sm" required></div>
                    <div><label class="text-xs font-medium text-zinc-500 uppercase mb-1.5 block tracking-wider">End</label><input type="date" name="end_date" class="w-full bg-zinc-900 border border-zinc-800 rounded-lg p-3 text-white outline-none text-sm" required></div>
                </div>
                <div>
                    <label class="text-xs font-medium text-zinc-500 uppercase mb-2 block tracking-wider">Type</label>
                    <div class="grid grid-cols-3 gap-2">
                        <label class="cursor-pointer"><input type="radio" name="color" value="#ef4444" class="peer sr-only" checked><div class="p-2 rounded-md border border-zinc-800 text-center text-xs text-zinc-400 peer-checked:bg-rose-500/20 peer-checked:text-rose-400 peer-checked:border-rose-500/50 transition">Restricted</div></label>
                        <label class="cursor-pointer"><input type="radio" name="color" value="#f59e0b" class="peer sr-only"><div class="p-2 rounded-md border border-zinc-800 text-center text-xs text-zinc-400 peer-checked:bg-amber-500/20 peer-checked:text-amber-400 peer-checked:border-amber-500/50 transition">Holiday</div></label>
                        <label class="cursor-pointer"><input type="radio" name="color" value="#a855f7" class="peer sr-only"><div class="p-2 rounded-md border border-zinc-800 text-center text-xs text-zinc-400 peer-checked:bg-purple-500/20 peer-checked:text-purple-400 peer-checked:border-purple-500/50 transition">Event</div></label>
                    </div>
                </div>
                <button class="w-full bg-white hover:bg-zinc-200 text-zinc-900 font-medium py-3 rounded-lg mt-2 text-sm">Create Event</button>
            </form>
        </div>
    </div>

    <!-- USER ADD/EDIT MODAL (UPDATED) -->
    <div id="userModal" class="fixed inset-0 z-50 hidden p-4 overflow-y-auto">
        <div class="absolute inset-0 bg-black/80 backdrop-blur-sm" onclick="toggleModal('userModal')"></div>
        <div class="relative top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 bg-zinc-950 border border-zinc-800 w-full max-w-md rounded-2xl p-6 shadow-2xl">
            <h3 class="text-lg font-semibold text-white mb-6" id="userModalTitle">Add User</h3>
            
            <form id="userForm" class="space-y-4">
                <input type="hidden" name="id" id="userIdInput">
                
                <div>
                    <label class="text-xs font-medium text-zinc-500 uppercase mb-1.5 block tracking-wider">Full Name</label>
                    <input type="text" name="full_name" id="u_fullname" class="w-full bg-zinc-900 border border-zinc-800 rounded-lg p-3 text-white text-sm focus:border-zinc-500 outline-none transition" required>
                </div>
                
                <div>
                    <label class="text-xs font-medium text-zinc-500 uppercase mb-1.5 block tracking-wider">Username</label>
                    <input type="text" name="username" id="u_username" class="w-full bg-zinc-900 border border-zinc-800 rounded-lg p-3 text-white text-sm focus:border-zinc-500 outline-none transition" required>
                </div>
                
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="text-xs font-medium text-zinc-500 uppercase mb-1.5 block tracking-wider">Vacation Bal.</label>
                        <input type="number" name="vacation_balance" id="u_vacation" class="w-full bg-zinc-900 border border-zinc-800 rounded-lg p-3 text-white text-sm focus:border-zinc-500 outline-none transition" required>
                    </div>
                    <div>
                        <label class="text-xs font-medium text-zinc-500 uppercase mb-1.5 block tracking-wider">Sick Bal.</label>
                        <input type="number" name="sick_balance" id="u_sick" class="w-full bg-zinc-900 border border-zinc-800 rounded-lg p-3 text-white text-sm focus:border-zinc-500 outline-none transition" required>
                    </div>
                </div>
                
                <div>
                    <label class="text-xs font-medium text-zinc-500 uppercase mb-1.5 block tracking-wider">Password</label>
                    <input type="text" name="password" id="u_password" placeholder="Leave empty to keep current" class="w-full bg-zinc-900 border border-zinc-800 rounded-lg p-3 text-white text-sm focus:border-zinc-500 outline-none transition">
                </div>
                
                <div>
                    <label class="text-xs font-medium text-zinc-500 uppercase mb-1.5 block tracking-wider">Role</label>
                    <select name="role" id="u_role" class="w-full bg-zinc-900 border border-zinc-800 rounded-lg p-3 text-white text-sm focus:border-zinc-500 outline-none transition cursor-pointer">
                        <option value="employee">Employee</option>
                        <option value="manager">Manager</option>
                        <option value="admin">Admin</option>
                    </select>
                </div>

                <div class="pt-2">
                    <button type="submit" class="w-full bg-white hover:bg-zinc-200 text-zinc-900 font-medium py-3 rounded-lg text-sm transition">Save User</button>
                </div>
            </form>
        </div>
    </div>

    <script src="{{ @BASE }}/public/js/library/jquery-3.6.0.min.js"></script>

    <script>
        window.LMS = {
            baseUrl: "{{ @BASE }}",
            role: "{{ @SESSION.role }}",
            pendingRequests: {{ @SESSION.role!='employee' ? json_encode(@pendingList) : '[]' }}
        };
    </script>
    
    <script src="{{ @BASE }}/public/js/dashboard.js"></script>
</body>
</html>